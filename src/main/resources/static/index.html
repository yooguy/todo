<!DOCTYPE html>
<html lang="en" x-data="todoApp()" class="p-8">
<head>
  <meta charset="UTF-8">
  <title>Alpine.js + Material 3 Todo List</title>

  <!-- Roboto Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Material 3 Web Components -->
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';
    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>

  <!-- Alpine.js -->
  <script src="https://unpkg.com/alpinejs@3.13.0" defer></script>

  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }

    .todo-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .todo-table th, .todo-table td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: center;
      vertical-align: middle;
    }

    .todo-table th {
      background-color: #f0f0f0;
      color: #333;
      font-weight: bold;
    }

    .todo-table td {
      background-color: #fff;
    }

    .todo-table tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .form-row {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .form-row md-outlined-text-field,
    .form-row input[type="date"],
    .form-row md-filled-button {
      flex: 1;
      min-width: 150px;
    }

    input[type="date"] {
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      font-family: 'Roboto', sans-serif;
    }

    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
    }
  </style>
</head>

<body>

<h1 class="md-typescale-display-medium mb-6">üìù To-do List</h1>

<!-- ÏûÖÎ†• Ìèº -->
<div class="form-row">
  <md-outlined-text-field label="New task" x-model="newTask"></md-outlined-text-field>
  <input type="date" x-model="startDate">
  <input type="date" x-model="endDate">
  <md-filled-button @click="addTodo" ?disabled="newTask.length === 0">
    Add
  </md-filled-button>
</div>

<!-- To-do List Table -->
<div class="card">
  <table class="todo-table">
    <thead>
    <tr>
      <th>Task</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>Status</th>
      <th>Toggle</th>
      <th>Actions</th>
    </tr>
    </thead>

    <tbody>
    <template x-for="todo in todos" :key="todo.id">
      <tr>
        <td :class="todo.completed ? 'text-gray-400 line-through' : ''" x-text="todo.title"></td>
        <td x-text="todo.startDate || '-'"></td>
        <td x-text="todo.endDate || '-'"></td>
        <td>
          <md-filled-button disabled>
            <span x-text="todo.completed ? 'Completed' : 'Pending'"></span>
          </md-filled-button>
        </td>
        <td>
          <md-switch
                  :selected="todo.completed"
                  @input="toggleTodo(todo.id)"
          ></md-switch>
        </td>
        <td>
          <md-outlined-button @click="confirmDelete(todo.id)">
            Delete
          </md-outlined-button>
        </td>
      </tr>
    </template>

    <tr x-show="todos.length === 0">
      <td colspan="6" class="text-center text-gray-400 py-4">
        No tasks yet. Add a new task!
      </td>
    </tr>
    </tbody>
  </table>
</div>

<!-- ÏÇ≠Ï†ú ÌôïÏù∏ Îã§Ïù¥ÏñºÎ°úÍ∑∏ -->
<md-dialog id="deleteDialog">
  <div slot="headline">Confirm Delete</div>
  <div>Are you sure you want to delete this task?</div>
  <div slot="actions">
    <md-text-button dialogAction="cancel">Cancel</md-text-button>
    <md-filled-button @click="deleteConfirmed()">Delete</md-filled-button>
  </div>
</md-dialog>

</body>

<!-- Alpine.js Ïª¥Ìè¨ÎÑåÌä∏ -->
<script>
  function todoApp() {
    return {
      todos: [],
      newTask: '',
      startDate: '',
      endDate: '',
      todoIdToDelete: null,

      async fetchTodos() {
        const res = await fetch('/api/todos');
        this.todos = await res.json();
      },

      async addTodo() {
        const res = await fetch('/api/todos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            title: this.newTask,
            startDate: this.startDate || null,
            endDate: this.endDate || null
          })
        });
        const newTodo = await res.json();
        this.todos.push(newTodo);
        this.newTask = '';
        this.startDate = '';
        this.endDate = '';
      },

      async toggleTodo(id) {
        const res = await fetch(`/api/todos/${id}/toggle`, {
          method: 'PATCH'
        });
        const updated = await res.json();
        const index = this.todos.findIndex(t => t.id === id);
        if (index > -1) {
          this.todos[index] = updated;
        }
      },

      confirmDelete(id) {
        this.todoIdToDelete = id;
        document.getElementById('deleteDialog').show();
      },

      async deleteConfirmed() {
        if (this.todoIdToDelete !== null) {
          await fetch(`/api/todos/${this.todoIdToDelete}`, {
            method: 'DELETE'
          });
          this.todos = this.todos.filter(t => t.id !== this.todoIdToDelete);
          this.todoIdToDelete = null;
        }
        document.getElementById('deleteDialog').close();
      },

      init() {
        this.fetchTodos();
      }
    }
  }
</script>

</html>
