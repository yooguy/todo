<!DOCTYPE html>
<html lang="en" x-data="todoApp()" class="p-8">
<head>
  <meta charset="UTF-8">
  <title>Alpine.js + Shoelace Todo List</title>

  <!-- Shoelace -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/shoelace.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/themes/light.css">

  <!-- Alpine.js -->
  <script src="https://unpkg.com/alpinejs@3.13.0" defer></script>

  <style>
    body {
      font-family: sans-serif;
    }

    .todo-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .todo-table th, .todo-table td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: center;
      vertical-align: middle;
    }

    .todo-table th {
      background-color: var(--sl-color-neutral-100);
      color: var(--sl-color-neutral-700);
      font-weight: bold;
    }

    .todo-table td {
      background-color: var(--sl-color-neutral-0);
    }

    .todo-table tr:nth-child(even) {
      background-color: var(--sl-color-neutral-50);
    }

    .form-row {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .form-row sl-input,
    .form-row sl-button {
      flex: 1;
      min-width: 150px;
    }
  </style>
</head>

<body>

<h1 class="text-3xl mb-6 flex items-center gap-2">
  üìù To-do List
</h1>

<!-- ÏûÖÎ†• Ìèº (Ìïú Ï§Ñ Ï†ïÎ†¨) -->
<div class="form-row">
  <sl-input placeholder="New task..." x-model="newTask"></sl-input>
  <sl-input label="Start Date" type="date" x-model="startDate"></sl-input>
  <sl-input label="End Date" type="date" x-model="endDate"></sl-input>
  <sl-button variant="primary" @click="addTodo" :disabled="newTask.length === 0">
    Add
  </sl-button>
</div>

<!-- To-do List Table -->
<sl-card>
  <table class="todo-table">
    <thead>
    <tr>
      <th>Task</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>Status</th>
      <th>Toggle</th>
      <th>Actions</th>
    </tr>
    </thead>

    <tbody>
    <template x-for="todo in todos" :key="todo.id">
      <tr>
        <td :class="todo.completed ? 'text-gray-400 line-through' : ''" x-text="todo.title"></td>
        <td x-text="todo.startDate || '-'"></td>
        <td x-text="todo.endDate || '-'"></td>
        <td>
          <sl-tag size="small" :variant="todo.completed ? 'success' : 'warning'">
            <span x-text="todo.completed ? 'Completed' : 'Pending'"></span>
          </sl-tag>
        </td>
        <td>
          <sl-switch
                  :checked="todo.completed"
                  @sl-change="toggleTodo(todo.id)"
          ></sl-switch>
        </td>
        <td>
          <sl-button
                  size="small"
                  variant="danger"
                  @click="confirmDelete(todo.id)"
          >
            Delete
          </sl-button>
        </td>
      </tr>
    </template>

    <tr x-show="todos.length === 0">
      <td colspan="6" class="text-center text-gray-400 py-4">
        No tasks yet. Add a new task!
      </td>
    </tr>
    </tbody>
  </table>
</sl-card>

<!-- ÏÇ≠Ï†ú ÌôïÏù∏ Îã§Ïù¥ÏñºÎ°úÍ∑∏ -->
<sl-dialog label="Confirm Delete" class="dialog-delete" x-ref="deleteDialog">
  <p>Are you sure you want to delete this task?</p>
  <div slot="footer" class="flex justify-end gap-2">
    <sl-button @click="$refs.deleteDialog.hide()">Cancel</sl-button>
    <sl-button variant="danger" @click="deleteConfirmed">Delete</sl-button>
  </div>
</sl-dialog>

</body>

<!-- Alpine.js Ïª¥Ìè¨ÎÑåÌä∏ -->
<script>
  function todoApp() {
    return {
      todos: [],
      newTask: '',
      startDate: '',
      endDate: '',
      todoIdToDelete: null,

      async fetchTodos() {
        const res = await fetch('/api/todos');
        this.todos = await res.json();
      },

      async addTodo() {
        const res = await fetch('/api/todos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            title: this.newTask,
            startDate: this.startDate || null,
            endDate: this.endDate || null
          })
        });
        const newTodo = await res.json();
        this.todos.push(newTodo);
        this.newTask = '';
        this.startDate = '';
        this.endDate = '';
      },

      async toggleTodo(id) {
        const res = await fetch(`/api/todos/${id}/toggle`, {
          method: 'PATCH'
        });
        const updated = await res.json();
        const index = this.todos.findIndex(t => t.id === id);
        if (index > -1) {
          this.todos[index] = updated;
        }
      },

      confirmDelete(id) {
        this.todoIdToDelete = id;
        this.$refs.deleteDialog.show();
      },

      async deleteConfirmed() {
        if (this.todoIdToDelete !== null) {
          await fetch(`/api/todos/${this.todoIdToDelete}`, {
            method: 'DELETE'
          });
          this.todos = this.todos.filter(t => t.id !== this.todoIdToDelete);
          this.todoIdToDelete = null;
        }
        this.$refs.deleteDialog.hide();
      },

      init() {
        this.fetchTodos();
      }
    }
  }
</script>

</html>
