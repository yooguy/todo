<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Toast UI Editor Preview + Save</title>

    <!-- Toast UI Editor CSS + JS -->
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

    <!-- Juice for inline style (optional) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/juice/8.0.0/juice.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            padding: 2rem;
            background: #f9f9f9;
        }
        #editor {
            margin-bottom: 2rem;
        }
        #preview, #html-code {
            padding: 1rem;
            background: white;
            border: 1px solid #ccc;
            margin-bottom: 1rem;
        }
        pre {
            white-space: pre-wrap;
            word-break: break-word;
            font-family: monospace;
            font-size: 0.9rem;
            background: #f3f3f3;
            padding: 1rem;
            border-radius: 4px;
        }
        input[type="text"] {
            padding: 0.5rem;
            width: 100%;
            margin-bottom: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 0.6rem 1.2rem;
            margin-right: 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-preview { background-color: #ccc; }
        .btn-save { background-color: #007bff; color: white; }
    </style>
</head>
<body>

<h1>ğŸ“ Toast UI Editor - Preview & Save</h1>

<!-- ì œëª© ì…ë ¥ -->
<input type="text" id="titleInput" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />

<!-- ì—ë””í„° ì˜ì—­ -->
<div id="editor"></div>

<!-- ë²„íŠ¼ ì˜ì—­ -->
<div>
    <button class="btn-preview" onclick="updatePreview()">ë¯¸ë¦¬ë³´ê¸°</button>
    <button class="btn-save" onclick="saveDocument()">ì €ì¥í•˜ê¸°</button>
</div>

<!-- Preview ì¶œë ¥ -->
<h2>ë¯¸ë¦¬ë³´ê¸° ê²°ê³¼</h2>
<div id="preview"></div>

<!-- HTML ì½”ë“œ ì¶œë ¥ -->
<h2>HTML ì½”ë“œ</h2>
<pre id="html-code"></pre>

<script>
    const editor = new toastui.Editor({
        el: document.querySelector('#editor'),
        height: '400px',
        initialEditType: 'markdown',
        previewStyle: 'vertical'
    });

    function updatePreview() {
        let html = editor.getHTML();

        if (window.juice) {
            html = juice(html);
        }

        document.getElementById('preview').innerHTML = html;
        document.getElementById('html-code').textContent = html;
    }

    async function saveDocument() {
        const title = document.getElementById('titleInput').value.trim();
        let html = editor.getHTML();

        if (!title) {
            alert('â— ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        if (window.juice) {
            html = juice(html);
        }

        const payload = {
            title: title,
            contentHtml: html
        };

        try {
            const res = await fetch('/api/docs', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!res.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜');

            const result = await res.json();
            alert('âœ… ì €ì¥ ì™„ë£Œ!');
            console.log('âœ… ì €ì¥ëœ ë¬¸ì„œ:', result);
        } catch (err) {
            alert('âŒ ì €ì¥ ì‹¤íŒ¨: ' + err.message);
        }
    }
</script>

</body>
</html>