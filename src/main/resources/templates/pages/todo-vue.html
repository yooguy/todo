<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo List - HTML First Vue 3</title>

    <!-- Tailwind CSS -->
    <link href="/vendors/tailwind/tailwind.min.css" rel="stylesheet">

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <!-- ExcelJS -->
    <script src="/vendors/exceljs/exceljs.min.js"></script>

    <style>
        html { scroll-behavior: smooth; }
        @keyframes fade-in {
            0% { opacity: 0; transform: translateY(20px) scale(0.95); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-fade-in {
            animation: fade-in 0.6s ease-out forwards;
        }
        .modal {
            background: rgba(0,0,0,0.5);
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-100 to-white p-10">

<div id="app" v-cloak class="max-w-5xl mx-auto space-y-10 animate-fade-in">

    <!-- í—¤ë” -->
    <div class="flex items-center justify-between">
        <h1 class="text-4xl font-extrabold text-slate-800 drop-shadow">ğŸ“‹ To-do List</h1>
        <button @click="downloadExcel" class="px-4 py-2 rounded-lg bg-emerald-500 hover:bg-emerald-600 text-white shadow">
            ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        </button>
    </div>

    <!-- ì…ë ¥í¼ -->
    <form @submit.prevent="createTodo"
          class="bg-white rounded-3xl shadow-2xl ring-1 ring-slate-200 p-6 flex flex-wrap items-center gap-4">
        <input v-model.trim="newTask" type="text" placeholder="New task..."
               class="flex-1 min-w-[180px] p-2 rounded-lg border" required />
        <input v-model="startDate" type="date" class="flex-1 min-w-[150px] p-2 rounded-lg border" />
        <input v-model="endDate" type="date" class="flex-1 min-w-[150px] p-2 rounded-lg border" />
        <button type="submit"
                class="px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white shadow"
                :disabled="!newTask.length">
            â• ì¶”ê°€
        </button>
    </form>

    <!-- To-do ë¦¬ìŠ¤íŠ¸ -->
    <div class="overflow-x-auto bg-white rounded-3xl shadow-2xl ring-1 ring-slate-200">
        <table class="w-full text-sm table-auto">
            <thead class="bg-slate-100 text-slate-700">
            <tr>
                <th class="p-4 text-left">ì‘ì—…</th>
                <th class="p-4 text-center">ì‹œì‘ì¼</th>
                <th class="p-4 text-center">ë§ˆê°ì¼</th>
                <th class="p-4 text-center">ìƒíƒœ</th>
                <th class="p-4 text-center">í† ê¸€</th>
                <th class="p-4 text-center">ì‚­ì œ</th>
            </tr>
            </thead>

            <tbody>
            <tr v-for="todo in todos" :key="todo.id" class="border-t hover:bg-slate-50 transition">
                <td class="p-4" :class="{ 'line-through text-gray-400': todo.completed }">{{ todo.title }}</td>
                <td class="p-4 text-center">{{ todo.startDate || '-' }}</td>
                <td class="p-4 text-center">{{ todo.endDate || '-' }}</td>
                <td class="p-4 text-center">
          <span :class="todo.completed ? 'text-green-600' : 'text-yellow-500'">
            {{ todo.completed ? 'ì™„ë£Œ' : 'ì§„í–‰ ì¤‘' }}
          </span>
                </td>
                <td class="p-4 text-center">
                    <input type="checkbox" v-model="todo.completed" @change="updateTodo(todo.id)" />
                </td>
                <td class="p-4 text-center">
                    <button @click="todoIdToDelete = todo.id" class="text-red-500 hover:underline">
                        ğŸ—‘ï¸
                    </button>
                </td>
            </tr>
            <tr v-if="todos.length === 0">
                <td colspan="6" class="p-8 text-center text-slate-400">
                    ğŸ“ ì•„ì§ ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- ì‚­ì œ ëª¨ë‹¬ (ì¡°ê±´ì  ë Œë”ë§) -->
    <div v-if="todoIdToDelete !== null" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl space-y-6 w-80">
            <h2 class="text-xl font-bold text-center">ì‚­ì œ í™•ì¸</h2>
            <p class="text-center text-slate-600">ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="flex justify-around">
                <button @click="todoIdToDelete = null" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded">
                    ì·¨ì†Œ
                </button>
                <button @click="deleteConfirmed" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded">
                    ì‚­ì œ
                </button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, onMounted } = Vue;

    createApp({
        setup() {
            const todos = ref([]);
            const newTask = ref('');
            const startDate = ref('');
            const endDate = ref('');
            const todoIdToDelete = ref(null);

            const fetchTodos = async () => {
                const res = await fetch('/api/todos');
                if (res.ok) todos.value = await res.json();
            };

            const createTodo = async () => {
                const res = await fetch('/api/todos', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: newTask.value, startDate: startDate.value, endDate: endDate.value })
                });
                if (res.ok) {
                    newTask.value = '';
                    startDate.value = '';
                    endDate.value = '';
                    await fetchTodos();
                }
            };

            const updateTodo = async (id) => {
                const res = await fetch(`/api/todos/${id}/toggle`, { method: 'PATCH' });
                if (res.ok) await fetchTodos();
            };

            const deleteConfirmed = async () => {
                const res = await fetch(`/api/todos/${todoIdToDelete.value}`, { method: 'DELETE' });
                if (res.ok) {
                    await fetchTodos();
                    todoIdToDelete.value = null;
                }
            };

            const downloadExcel = () => {
                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet('Todos');
                worksheet.columns = [
                    { header: 'ì‘ì—…', key: 'title' },
                    { header: 'ì‹œì‘ì¼', key: 'startDate' },
                    { header: 'ë§ˆê°ì¼', key: 'endDate' },
                    { header: 'ìƒíƒœ', key: 'status' }
                ];
                todos.value.forEach(todo => worksheet.addRow({
                    title: todo.title, startDate: todo.startDate, endDate: todo.endDate,
                    status: todo.completed ? 'ì™„ë£Œ' : 'ì§„í–‰ ì¤‘'
                }));
                workbook.xlsx.writeBuffer().then(buffer => {
                    const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'todo-list.xlsx';
                    a.click();
                    URL.revokeObjectURL(url);
                });
            };

            onMounted(fetchTodos);

            return { todos, newTask, startDate, endDate, todoIdToDelete, createTodo, updateTodo, deleteConfirmed, downloadExcel };
        }
    }).mount('#app');
</script>

</body>
</html>